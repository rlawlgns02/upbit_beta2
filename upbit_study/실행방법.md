# 업비트 AI 트레이딩 시스템 실행 가이드

## 목차
1. [환경 설정](#1-환경-설정)
2. [프로그램 실행](#2-프로그램-실행)
3. [API 키 설정](#3-api-키-설정)
4. [LSTM 모델 학습](#4-lstm-모델-학습)
5. [LSTM 단타 자동매매](#5-lstm-단타-자동매매)
6. [원클릭 자동매매](#6-원클릭-자동매매)
7. [문제 해결](#7-문제-해결)

---

## 1. 환경 설정

### 필수 요구사항
- Python 3.10 이상
- Windows 10/11 또는 Linux/Mac

### 패키지 설치

```bash
cd c:\dev2\upbit_beta2\upbit_study
pip install -r requirements.txt
```

### 환경 변수 설정 (선택사항)

`.env` 파일을 생성하여 API 키를 저장할 수 있습니다:

```env
UPBIT_ACCESS_KEY=your_access_key_here
UPBIT_SECRET_KEY=your_secret_key_here
```

---

## 2. 프로그램 실행

### 웹 서버 시작

```bash
cd c:\dev2\upbit_beta2\upbit_study
python webapp.py
```

### 브라우저 접속

```
http://localhost:8000
```

서버가 정상 실행되면 터미널에 다음과 같이 표시됩니다:
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

---

## 3. API 키 설정

### 업비트 API 키 발급

1. [업비트](https://upbit.com) 접속 및 로그인
2. 마이페이지 → Open API 관리
3. Open API Key 발급하기 클릭
4. **필수 권한 설정**:
   - ✅ 자산조회
   - ✅ 주문조회
   - ✅ 주문하기 (자동매매 사용 시 필수)
5. IP 주소 등록 (선택)
6. Access Key와 Secret Key 복사

### 프로그램에서 API 키 입력

1. 웹 페이지 상단 **"설정"** 탭 클릭
2. API 키 입력:
   - **Access Key**: 발급받은 Access Key 입력
   - **Secret Key**: 발급받은 Secret Key 입력
3. **"연결 테스트"** 버튼 클릭
4. "API 연결 성공" 메시지 확인

> ⚠️ **주의**: API 키는 절대 타인에게 공유하지 마세요!

---

## 4. LSTM 모델 학습

### 4.1 LSTM 단타 탭 이동

웹 페이지 상단 메뉴에서 **"LSTM 단타"** 클릭

### 4.2 학습할 코인 선택

| 방법 | 설명 |
|-----|------|
| `+ 추가` 버튼 | 개별 코인 선택 |
| `전체` 버튼 | 모든 KRW 마켓 코인 선택 |

권장: 처음에는 2~3개 코인으로 테스트 (예: KRW-BTC, KRW-ETH)

### 4.3 학습 파라미터 설정

| 파라미터 | 기본값 | 설명 |
|---------|-------|------|
| Epochs | 50 | 학습 반복 횟수 (높을수록 정확도↑, 시간↑) |
| Batch Size | 32 | 한 번에 처리하는 데이터 수 |
| Seq Length | 60 | 예측에 사용할 과거 데이터 수 |
| Learning Rate | 0.001 | 학습률 |

### 4.4 학습 시작

1. **"학습 시작"** 버튼 클릭 (선택한 코인만)
2. 또는 **"전체 코인 학습 시작"** 버튼 클릭

### 4.5 학습 상태 확인

- **진행 중**: 현재 학습 중인 코인 수
- **대기 중**: 학습 대기열에 있는 코인 수
- **완료됨**: 학습 완료된 코인 수
- **오류**: 학습 실패한 코인 수

### 4.6 학습 완료 확인

학습이 완료되면:
- `models/` 폴더에 `.pt` 파일 생성
- 예: `lstm_BTC.pt`, `lstm_ETH_best.pt`

### 4.7 모델 관리

```bash
# 오래된 체크포인트 정리 (디스크 공간 절약)
python cleanup_old_models.py
```

---

## 5. LSTM 단타 자동매매

### 5.1 자동매매 섹션 위치

LSTM 단타 탭 하단의 **"LSTM 단타 자동매매"** 섹션

### 5.2 거래 설정

| 항목 | 설명 | 권장값 |
|-----|------|-------|
| 거래할 코인 | 학습된 모델이 있는 코인 선택 | 2~3개 |
| 1회 거래 금액 | 한 번에 매수할 금액 (최소 10,000원) | 50,000원 |
| 최대 동시 포지션 | 동시에 보유할 수 있는 코인 수 | 3개 |
| 체크 간격 | 시장 분석 주기 (초) | 30초 |

### 5.3 알고리즘 설정

| 항목 | 설명 | 권장값 |
|-----|------|-------|
| LSTM 신호 가중치 | LSTM 예측 vs 기술적 지표 비율 | 60% |
| 급락 감지 | 급락 시 즉시 매도 (손실 방지) | ✅ ON |
| 추세 반전 감지 | RSI/MACD 반전 신호 감지 | ✅ ON |
| 동적 손절/익절 | ATR 기반 자동 조절 | ✅ ON |
| 익절률 | 목표 수익률 (%) | 0.5% |
| 손절률 | 최대 손실률 (%) | 0.3% |

### 5.4 자동매매 시작

1. 설정 완료 후 **"자동매매 시작"** (녹색 버튼) 클릭
2. 상태가 "자동매매 실행 중"으로 변경됨

### 5.5 실시간 모니터링

#### 통계 표시
| 항목 | 설명 |
|-----|------|
| 승률 | 수익 거래 / 전체 거래 |
| 총 거래 | 실행된 총 거래 횟수 |
| 총 수익 | 누적 손익 (KRW) |
| 활성 포지션 | 현재 보유 중인 코인 수 |

#### 포지션 테이블
| 컬럼 | 설명 |
|-----|------|
| 코인 | 보유 중인 코인 (예: KRW-BTC) |
| 진입가 | 매수 시점 가격 |
| 현재가 | 실시간 현재 가격 |
| 수익률 | 현재 손익률 (%) |
| LSTM 예측 | UP / DOWN / NEUTRAL |
| 보유시간 | 매수 후 경과 시간 |

### 5.6 자동매매 제어

| 버튼 | 기능 |
|-----|------|
| **자동매매 중지** (빨간색) | 새로운 거래 중단, 기존 포지션 유지 |
| **긴급 전체 매도** (노란색) | 모든 포지션 즉시 시장가 매도 |
| 개별 **매도** 버튼 | 특정 코인만 매도 |

### 5.7 매매 로직 설명

#### 매수 조건 (모두 충족 시)
```
1. LSTM 예측: 가격 상승 예측 (>0.3%)
2. 기술적 지표 신호: 매수 우세
   - RSI 과매도 (<30) 또는 상승 추세
   - MACD 골든크로스
   - 볼린저밴드 하단 근처
3. 잔고 충분 (≥10,000원)
4. 포지션 여유 있음
5. 쿨다운 시간 경과 (60초)
```

#### 매도 조건 (하나라도 충족 시)
```
1. 익절: 수익률 ≥ 설정 익절률
2. 손절: 손실률 ≥ 설정 손절률
3. 급락 감지: 1분 내 -2% 이상 하락
4. LSTM 예측: 강한 하락 신호 (<-1%)
5. 최대 보유시간 초과 (60분)
6. 추세 반전 신호 감지
```

---

## 6. 원클릭 자동매매

### 6.1 원클릭 자동매매 탭

메인 페이지의 **"원클릭 자동매매"** 탭 또는 **"자동매매"** 탭

### 6.2 설정

| 항목 | 설명 |
|-----|------|
| 총 투자금액 | 전체 투자할 금액 |
| 코인 개수 | 분산 투자할 코인 수 |
| 분석 모드 | 거래량 Top 50/100 등 |
| 목표 수익률 | 익절 기준 (%) |
| 손절률 | 손절 기준 (%) |

### 6.3 사용 방법

1. 설정 완료
2. **"자동매매 시작"** 클릭
3. AI가 자동으로 코인 선정 및 매매 실행

---

## 7. 문제 해결

### API 연결 실패

```
❌ 계좌 정보 조회 실패 - 인증 실패
```

**해결책**:
1. API 키가 올바른지 확인
2. API 권한 설정 확인 (주문하기 권한 필요)
3. IP 제한 설정 확인

### 모델 로드 실패

```
⚠️ 모델 로드 실패: 파일을 찾을 수 없습니다
```

**해결책**:
1. `models/` 폴더에 `.pt` 파일이 있는지 확인
2. 학습을 먼저 실행하여 모델 생성

### 거래 실패

```
❌ 매수 실패: 최소 주문 금액은 5,000원입니다
```

**해결책**:
1. 1회 거래 금액을 10,000원 이상으로 설정
2. 잔고 확인

### 학습이 너무 오래 걸림

**해결책**:
1. Epochs 수 줄이기 (50 → 30)
2. 한 번에 학습하는 코인 수 줄이기
3. GPU 사용 가능한 환경 확인

### 서버 시작 실패

```
Error: Port 8000 already in use
```

**해결책**:
```bash
# 다른 포트로 실행
uvicorn webapp:app --host 0.0.0.0 --port 8001
```

---

## 부록: 자주 사용하는 명령어

```bash
# 서버 실행
python webapp.py

# 백그라운드 실행 (Linux/Mac)
nohup python webapp.py &

# 모델 체크포인트 정리
python cleanup_old_models.py

# 의존성 설치
pip install -r requirements.txt

# LSTM 학습용 추가 패키지
pip install -r requirements_train.txt
```

---

## 면책 조항

> ⚠️ **투자 주의사항**
> - 이 프로그램은 투자 조언을 제공하지 않습니다.
> - 암호화폐 투자는 원금 손실의 위험이 있습니다.
> - 소액으로 충분히 테스트 후 사용하세요.
> - 투자에 대한 모든 책임은 사용자에게 있습니다.

---

*마지막 업데이트: 2024*
